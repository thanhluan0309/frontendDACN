{"ast":null,"code":"import _regeneratorRuntime from\"D:/Deploy/frontendDACN/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/Deploy/frontendDACN/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _defineProperty from\"D:/Deploy/frontendDACN/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"D:/Deploy/frontendDACN/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"D:/Deploy/frontendDACN/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import\"./style.css\";import*as Icon from\"react-bootstrap-icons\";import{sendemail}from\"./emailBehavior\";import{useState,useEffect}from\"react\";import{CheckLoginUser,LoginUser,udlus}from\"../Login/UserBehavior\";import{useNavigate}from\"react-router-dom\";import{isExpired,decodeToken}from\"react-jwt\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export var FormSendMail=function FormSendMail(_ref){var CodeShare=_ref.CodeShare,email=_ref.email,setListUserAccess=_ref.setListUserAccess,setListUserRequest=_ref.setListUserRequest,getListfromUser=_ref.getListfromUser;var decodetoken;var nav=useNavigate();var _useState=useState({emailNeedAccess:email,code:\"\"}),_useState2=_slicedToArray(_useState,2),form=_useState2[0],setform=_useState2[1];var handlechange=function handlechange(event){setform(_objectSpread(_objectSpread({},form),{},_defineProperty({},event.target.name,event.target.value)));};var startSendMail=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(event){var username,email,formsendmail,FormUpdateListUser,FormAccessUser,LoginData,answer,update;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0://check List user\nusername=localStorage.getItem(\"username\");email=localStorage.getItem(\"email\");decodetoken=decodeToken(form.code);formsendmail={email:decodetoken.CODESHARE.split(\"#\")[3],subject:\"Request Access from mail : \".concat(form.emailNeedAccess),text:\"Hello I want to join with you ^^\"};FormUpdateListUser={_id:decodetoken.CODESHARE.split(\"#\")[2],ListEmailJoin:[],ListEmailRequestJoin:[]};FormAccessUser={username:decodetoken.CODESHARE.split(\"#\")[1],password:decodetoken.CODESHARE.split(\"#\")[0]};_context.next=8;return CheckLoginUser(FormAccessUser);case 8:LoginData=_context.sent;FormUpdateListUser.ListEmailJoin=Array.from(LoginData.user.ListEmailJoin);FormUpdateListUser.ListEmailRequestJoin=Array.from(LoginData.user.ListEmailRequestJoin);if(!(FormUpdateListUser.ListEmailJoin.indexOf(\"\".concat(email))>-1)){_context.next=23;break;}answer=window.confirm(\"This email has been approved, do you want to move??\");if(!answer){_context.next=22;break;}localStorage.clear();_context.next=17;return LoginUser(FormAccessUser);case 17:localStorage.setItem(\"username\",username+\" (You are in another space)\");localStorage.setItem(\"email\",email);localStorage.setItem(\"managerUser\",false);nav(\"/homepage\");window.location.reload();case 22:return _context.abrupt(\"return\");case 23:if(!(FormUpdateListUser.ListEmailRequestJoin.indexOf(\"\".concat(email))<0)){_context.next=33;break;}console.log(\"formsendmail\",formsendmail);alert(\"Email has been sent request !!\");FormUpdateListUser.ListEmailRequestJoin.push(\"\".concat(email));_context.next=29;return udlus(FormUpdateListUser);case 29:update=_context.sent;_context.next=32;return sendemail(formsendmail);case 32:return _context.abrupt(\"return\");case 33:event.preventDefault();case 34:case\"end\":return _context.stop();}}},_callee);}));return function startSendMail(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"sendmail\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"  CollapseForm collapse\",id:\"collapseExample\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"shadow border border-primary cssforform-Body\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"exampleInputEmail1\",className:\"form-label\",children:\"Email address\"}),/*#__PURE__*/_jsx(\"input\",{disabled:true,type:\"email\",name:\"emailNeedAccess\",onChange:handlechange,value:form.emailNeedAccess,className:\"form-control\",id:\"exampleInputEmail1\",\"aria-describedby\":\"emailHelp\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"exampleInputPassword1\",className:\"form-label\",children:\"CODE\"}),/*#__PURE__*/_jsx(\"input\",{onChange:handlechange,value:form.code,name:\"code\",type:\"text\",className:\"form-control\",id:\"exampleInputPassword1\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:startSendMail,className:\"btn btn-primary\",children:\"Send\"})]})}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",\"data-bs-toggle\":\"collapse\",\"data-bs-target\":\"#collapseExample\",\"aria-expanded\":\"false\",\"aria-controls\":\"collapseExample\",className:\"btn btn-info btn-circle btn-xl btnCollapse\",children:/*#__PURE__*/_jsx(Icon.ListCheck,{})})]})});};","map":{"version":3,"names":["Icon","sendemail","useState","useEffect","CheckLoginUser","LoginUser","udlus","useNavigate","isExpired","decodeToken","FormSendMail","CodeShare","email","setListUserAccess","setListUserRequest","getListfromUser","decodetoken","nav","emailNeedAccess","code","form","setform","handlechange","event","target","name","value","startSendMail","username","localStorage","getItem","formsendmail","CODESHARE","split","subject","text","FormUpdateListUser","_id","ListEmailJoin","ListEmailRequestJoin","FormAccessUser","password","LoginData","Array","from","user","indexOf","answer","window","confirm","clear","setItem","location","reload","console","log","alert","push","update","preventDefault"],"sources":["D:/Deploy/frontendDACN/src/components/SendEmail/Sendmail.js"],"sourcesContent":["import \"./style.css\";\r\nimport * as Icon from \"react-bootstrap-icons\";\r\nimport { sendemail } from \"./emailBehavior\";\r\nimport { useState, useEffect } from \"react\";\r\nimport { CheckLoginUser, LoginUser, udlus } from \"../Login/UserBehavior\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { isExpired, decodeToken } from \"react-jwt\";\r\n\r\nexport const FormSendMail = ({\r\n  CodeShare,\r\n  email,\r\n  setListUserAccess,\r\n  setListUserRequest,\r\n  getListfromUser,\r\n}) => {\r\n  let decodetoken;\r\n  const nav = useNavigate();\r\n\r\n  const [form, setform] = useState({\r\n    emailNeedAccess: email,\r\n    code: \"\",\r\n  });\r\n\r\n  const handlechange = (event) => {\r\n    setform({ ...form, [event.target.name]: event.target.value });\r\n  };\r\n\r\n  const startSendMail = async (event) => {\r\n    //check List user\r\n    let username = localStorage.getItem(\"username\");\r\n    let email = localStorage.getItem(\"email\");\r\n    decodetoken = decodeToken(form.code);\r\n    let formsendmail = {\r\n      email: decodetoken.CODESHARE.split(\"#\")[3],\r\n      subject: `Request Access from mail : ${form.emailNeedAccess}`,\r\n      text: \"Hello I want to join with you ^^\",\r\n    };\r\n    let FormUpdateListUser = {\r\n      _id: decodetoken.CODESHARE.split(\"#\")[2],\r\n      ListEmailJoin: [],\r\n      ListEmailRequestJoin: [],\r\n    };\r\n    let FormAccessUser = {\r\n      username: decodetoken.CODESHARE.split(\"#\")[1],\r\n      password: decodetoken.CODESHARE.split(\"#\")[0],\r\n    };\r\n    const LoginData = await CheckLoginUser(FormAccessUser);\r\n    FormUpdateListUser.ListEmailJoin = Array.from(LoginData.user.ListEmailJoin);\r\n    FormUpdateListUser.ListEmailRequestJoin = Array.from(\r\n      LoginData.user.ListEmailRequestJoin\r\n    );\r\n    if (FormUpdateListUser.ListEmailJoin.indexOf(`${email}`) > -1) {\r\n      const answer = window.confirm(\r\n        \"This email has been approved, do you want to move??\"\r\n      );\r\n      if (answer) {\r\n        localStorage.clear();\r\n        await LoginUser(FormAccessUser);\r\n        localStorage.setItem(\r\n          \"username\",\r\n          username + \" (You are in another space)\"\r\n        );\r\n        localStorage.setItem(\"email\", email);\r\n\r\n        localStorage.setItem(\"managerUser\", false);\r\n        nav(\"/homepage\");\r\n        window.location.reload();\r\n      }\r\n      return;\r\n    }\r\n    if (FormUpdateListUser.ListEmailRequestJoin.indexOf(`${email}`) < 0) {\r\n      console.log(\"formsendmail\", formsendmail);\r\n      alert(\"Email has been sent request !!\");\r\n\r\n      FormUpdateListUser.ListEmailRequestJoin.push(`${email}`);\r\n      const update = await udlus(FormUpdateListUser);\r\n      // setListUserAccess(update.data.updateUser.ListEmailJoin);\r\n      // setListUserRequest(update.data.updateUser.ListEmailRequestJoin);\r\n      await sendemail(formsendmail);\r\n\r\n      return;\r\n    }\r\n\r\n    event.preventDefault();\r\n  };\r\n  return (\r\n    <>\r\n      <div className=\"sendmail\">\r\n        <div className=\"  CollapseForm collapse\" id=\"collapseExample\">\r\n          <div className=\"shadow border border-primary cssforform-Body\">\r\n            <div className=\"mb-3\">\r\n              <label htmlFor=\"exampleInputEmail1\" className=\"form-label\">\r\n                Email address\r\n              </label>\r\n              <input\r\n                disabled\r\n                type=\"email\"\r\n                name=\"emailNeedAccess\"\r\n                onChange={handlechange}\r\n                value={form.emailNeedAccess}\r\n                className=\"form-control\"\r\n                id=\"exampleInputEmail1\"\r\n                aria-describedby=\"emailHelp\"\r\n              />\r\n            </div>\r\n            <div className=\"mb-3\">\r\n              <label htmlFor=\"exampleInputPassword1\" className=\"form-label\">\r\n                CODE\r\n              </label>\r\n              <input\r\n                onChange={handlechange}\r\n                value={form.code}\r\n                name=\"code\"\r\n                type=\"text\"\r\n                className=\"form-control\"\r\n                id=\"exampleInputPassword1\"\r\n              />\r\n            </div>\r\n            <button onClick={startSendMail} className=\"btn btn-primary\">\r\n              Send\r\n            </button>\r\n          </div>\r\n        </div>\r\n        <button\r\n          type=\"button\"\r\n          data-bs-toggle=\"collapse\"\r\n          data-bs-target=\"#collapseExample\"\r\n          aria-expanded=\"false\"\r\n          aria-controls=\"collapseExample\"\r\n          className=\"btn btn-info btn-circle btn-xl btnCollapse\"\r\n        >\r\n          <Icon.ListCheck></Icon.ListCheck>\r\n        </button>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}